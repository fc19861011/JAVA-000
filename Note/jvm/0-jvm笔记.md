# JVM学习笔记

## 一、 JVM是什么，能解决什么问题?

​       JVM是Java Virtual Machine（Java虚拟机）的缩写，JVM是一种用于计算机的**规范**，它是一个虚构出来的计算机，是通过在实际计算机上仿真模拟各种计算机功能来实现的。

​       JVM帮助编程语言屏蔽与具体平台（OS）相关的信息，使得由各中编程语言编写的编译程序只需在JVM上生成运行的字节码，就可以在多种平台上运行（WORA, Write Once Run Anywhere）。

## 二、JVM的前世今生

## 三、JVM体系结构

​       JVM主要分为类加载器子系统、运行时数据区、执行引擎、本地方法接口以及垃圾收集模块。

![structure](.\img\structure.png)

### 3.1 类加载器（ClassLoader）

#### 3.1.1 类加载器作用

​       负责加载class文件，class文件**在文件开头有特定的文件标识**（比如说编译的版本信息），将class文件的字节码内容加载到内存中，并将这些内容转换成方法区中的运行时数据结构，classLoader只负责class文件的加载，至于它是否可以运行，则有Execution Engine（执行引擎）决定。

#### 3.1.2 字节码

​       jvm不能执行java文件，我们编写的java文件需要经过javac编译器编译成字节码（.class）,然后再由JVM执行。`
`java bytecode 由单字节（byte）的指令组成，理论上最多支持256个操作码（opcode）。但是实际上java只使用了200左右的操作码，还有一些操作码则保留给调试操作。ClassLoader将.class文件加载并初始化后，得到当前类的**Class模板**，并将其存放在**方法区**

- 使用字节码有什么优势？
  java语言通过字节码的方式，在一定程度上解决了传统解释语言执行效率低的问题，同时又保留了解释型语言可移植的特点。所以java程序运行时比较高效，而且由于字节码并不专对一种特定的机器，因此，java程序无须重新编译便可在多种不同的计算机上运行。

> 解释型语言：在运行的时候将程序翻译成机器语言。解释型语言的程序不需要在运行前编译（java语言是需要提前编译成字节码的），在程序运行的时候才进行翻译，专门的解释器负责在每个语句执行的时候解释程序代码。这样解释型语言每执行一次就要翻译一次，效率比较低。（例如：python、php）

- 指令分类：

  根据指令的性质，主要可以分为四个大类

  1. 栈操作指令，包括与局部变量交互的指令
  2. 程序流程控制指令
  3. 对象操作指令，包括方法调用指令
  4. 算术运算以及类型转换指令

- 方法调用的指令：

  1、栈操作指令，包括与局部变量交互的指令。

  2、程序流程控制指令。

  3、对象操作指令，包括方法调用指令。

  4、算术运算以及类型转换指令。

- 字节码的运行时结构

  JVM是一台**基于栈**的计算机器
  每个线程都有一个独属于自己的线程栈（JVM Stack），用于存储栈帧（Frame）。
  每一次的方法调用，JVM都会自动创建一个栈帧。
  栈帧由操作数栈，局部变量数组以及一个Class引用组成。
  Class引用指向当前方法 在运行时常量池中对应的Class。

#### 3.1.3 ClassLoader种类



#### 3.1.4 双亲委派的机制

#### 3.1.5 沙箱安全机制

### 3.2  运行时数据区（Runtime Data Area）

#### 3.2.1 分代模型

#### 3.2.2 方法区（Method Area）

#### 3.2.3 栈（栈帧）

#### 3.2.4 本地方法栈（Native Method Stack）

#### 3.2.5 程序计数器（PC寄存器）

### 3.3  执行引擎（Execution Engine）

### 3.4 本地方法接口（Native Interface） 

## 四、垃圾回收机制

## 五、性能调优



#### 思考：

java类是什么时候被加载到jvm的，加载和执行的过程是什么？



https://www.cnblogs.com/zongheng14/p/12041005.html

## java类的运行过程

 https://zhuanlan.zhihu.com/p/291027786
https://zhuanlan.zhihu.com/p/291044796 